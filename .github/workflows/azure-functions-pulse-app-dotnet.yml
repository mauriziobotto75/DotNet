 
         CREATE SCHEMA delivery_pulse_intranet AUTHORIZATION postgres;

-- delivery_pulse_intranet.countries definition

-- Drop table

-- DROP TABLE delivery_pulse_intranet.countries;

CREATE TABLE delivery_pulse_intranet.countries (
	id int4 NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	iso3166_1_alpha2 varchar(2) NOT NULL,
	"name" varchar(64) NOT NULL,
	CONSTRAINT countries_pkey PRIMARY KEY (id),
	CONSTRAINT countries_unique_isoalpha2 UNIQUE (iso3166_1_alpha2)
);

-- Permissions

ALTER TABLE delivery_pulse_intranet.countries OWNER TO postgres;
GRANT ALL ON TABLE delivery_pulse_intranet.countries TO postgres;


-- delivery_pulse_intranet.industries definition

-- Drop table

-- DROP TABLE delivery_pulse_intranet.industries;

CREATE TABLE delivery_pulse_intranet.industries (
	id int4 NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	"name" varchar(64) NOT NULL,
	description varchar(256) NOT NULL,
	p3 varchar(256) NOT NULL, -- E-Monitoring P3 level
	p4 varchar(256) NOT NULL, -- E-Monitoring P4 level
	CONSTRAINT industries_pkey PRIMARY KEY (id),
	CONSTRAINT industries_unique_name UNIQUE (name)
);

-- Column comments

COMMENT ON COLUMN delivery_pulse_intranet.industries.p3 IS 'E-Monitoring P3 level';
COMMENT ON COLUMN delivery_pulse_intranet.industries.p4 IS 'E-Monitoring P4 level';

-- Permissions

ALTER TABLE delivery_pulse_intranet.industries OWNER TO postgres;
GRANT ALL ON TABLE delivery_pulse_intranet.industries TO postgres;


-- delivery_pulse_intranet.question_clusters definition

-- Drop table

-- DROP TABLE delivery_pulse_intranet.question_clusters;

CREATE TABLE delivery_pulse_intranet.question_clusters (
	id int4 NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	"name" varchar(128) NOT NULL,
	description varchar(512) NULL,
	CONSTRAINT question_cluster_pkey PRIMARY KEY (id)
);


-- Permissions

ALTER TABLE delivery_pulse_intranet.question_clusters OWNER TO postgres;
GRANT ALL ON TABLE delivery_pulse_intranet.question_clusters TO postgres;


-- delivery_pulse_intranet.settings definition

-- Drop table

-- DROP TABLE delivery_pulse_intranet.settings;

CREATE TABLE delivery_pulse_intranet.settings (
	id int4 NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	"key" varchar(128) NOT NULL,
	value varchar(1000) NOT NULL,
	CONSTRAINT settings_pkey PRIMARY KEY (id),
	CONSTRAINT settings_unique_key UNIQUE (key)
);

-- Permissions

ALTER TABLE delivery_pulse_intranet.settings OWNER TO postgres;
GRANT ALL ON TABLE delivery_pulse_intranet.settings TO postgres;


-- delivery_pulse_intranet.survey_templates definition

-- Drop table

-- DROP TABLE delivery_pulse_intranet.survey_templates;

CREATE TABLE delivery_pulse_intranet.survey_templates (
	id int4 NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	"name" varchar(128) NOT NULL, -- nome parlante identifica la survey
	status varchar(64) NOT NULL, -- ENABLED o DISABLED
	description varchar(512) NULL,
	"type" varchar(10) NOT NULL, -- TEAM o CLIENT
	CONSTRAINT survey_templates_pkey PRIMARY KEY (id)
);

-- Column comments

COMMENT ON COLUMN delivery_pulse_intranet.survey_templates."name" IS 'nome parlante identifica la survey';
COMMENT ON COLUMN delivery_pulse_intranet.survey_templates.status IS 'ENABLED o DISABLED';
COMMENT ON COLUMN delivery_pulse_intranet.survey_templates."type" IS 'TEAM o CLIENT';

-- Permissions

ALTER TABLE delivery_pulse_intranet.survey_templates OWNER TO postgres;
GRANT ALL ON TABLE delivery_pulse_intranet.survey_templates TO postgres;


-- delivery_pulse_intranet.users definition

-- Drop table

-- DROP TABLE delivery_pulse_intranet.users;

CREATE TABLE delivery_pulse_intranet.users (
	id int4 NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	"name" varchar(128) NOT NULL,
	surname varchar(128) NOT NULL,
	username varchar(64) NOT NULL,
	CONSTRAINT users_pkey PRIMARY KEY (id),
	CONSTRAINT users_unique_name UNIQUE (username)
);

-- Permissions

ALTER TABLE delivery_pulse_intranet.users OWNER TO postgres;
GRANT ALL ON TABLE delivery_pulse_intranet.users TO postgres;


-- delivery_pulse_intranet.answer_type definition

-- Drop table

-- DROP TABLE delivery_pulse_intranet.answer_type;

CREATE TABLE delivery_pulse_intranet.answer_type (
	id int4 NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	id_cluster int4 NOT NULL,
	"name" varchar(64) NULL, -- etichetta della risposta: utile in caso di risposta multipla (vedi cluster team)
	"type" varchar(64) NOT NULL, -- tipologia di valutazione (1-5, 0-10, freee text)
	CONSTRAINT answer_type_pkey PRIMARY KEY (id),
	CONSTRAINT answer_type_fk FOREIGN KEY (id_cluster) REFERENCES delivery_pulse_intranet.question_clusters(id)
);

-- Column comments

COMMENT ON COLUMN delivery_pulse_intranet.answer_type."name" IS 'etichetta della risposta: utile in caso di risposta multipla (vedi cluster team)';
COMMENT ON COLUMN delivery_pulse_intranet.answer_type."type" IS 'tipologia di valutazione (1-5, 0-10, freee text)';

-- Permissions

ALTER TABLE delivery_pulse_intranet.answer_type OWNER TO postgres;
GRANT ALL ON TABLE delivery_pulse_intranet.answer_type TO postgres;


-- delivery_pulse_intranet.engagements definition

-- Drop table

-- DROP TABLE delivery_pulse_intranet.engagements;

CREATE TABLE delivery_pulse_intranet.engagements (
	id int4 NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	engagement_id varchar(128) NOT NULL,
	eng_local_reference varchar(256) NOT NULL,
	eng_name varchar(256) NULL,
	start_date date NOT NULL,
	end_date date NOT NULL,
	industry int4 NOT NULL,
	country int4 NOT NULL,
	account varchar(256) NOT NULL,
	budget numeric NOT NULL,
	em_username varchar(128) NOT NULL,
	em_name varchar(256) NOT NULL,
	em_mail varchar(128) NOT NULL,
	delivery_executive_username varchar(128) NOT NULL,
	delivery_executive_name varchar(256) NOT NULL,
	delivery_executive_mail varchar(128) NOT NULL,
	account_manager_username varchar(128) NOT NULL,
	account_manager_name varchar(256) NOT NULL,
	account_manager_mail varchar(128) NOT NULL,
	CONSTRAINT engagement_unique_engid UNIQUE (engagement_id),
	CONSTRAINT engagements_pkey PRIMARY KEY (id),
	CONSTRAINT engagements_fk_country_id FOREIGN KEY (country) REFERENCES delivery_pulse_intranet.countries(id),
	CONSTRAINT engagements_fk_industry_id FOREIGN KEY (industry) REFERENCES delivery_pulse_intranet.industries(id)
);
CREATE INDEX engagements_idx_name ON delivery_pulse_intranet.engagements USING btree (eng_name);
CREATE INDEX fki_engagements_fk_country_id ON delivery_pulse_intranet.engagements USING btree (country);
CREATE INDEX fki_engagements_fk_industry_id ON delivery_pulse_intranet.engagements USING btree (industry);

-- Permissions

ALTER TABLE delivery_pulse_intranet.engagements OWNER TO postgres;
GRANT ALL ON TABLE delivery_pulse_intranet.engagements TO postgres;


-- delivery_pulse_intranet.survey_questions_templates definition

-- Drop table

-- DROP TABLE delivery_pulse_intranet.survey_questions_templates;

CREATE TABLE delivery_pulse_intranet.survey_questions_templates (
	id int4 NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	id_survey int4 NOT NULL,
	question varchar(4000) NOT NULL,
	status varchar(64) NOT NULL, -- enabled o disabled
	id_cluster int4 NOT NULL, -- identificativo cluster question
	CONSTRAINT survey_questions_templates_pkey PRIMARY KEY (id),
	CONSTRAINT survey_questions_templates_fk FOREIGN KEY (id_cluster) REFERENCES delivery_pulse_intranet.question_clusters(id),
	CONSTRAINT survey_questions_templates_fk_surveyid FOREIGN KEY (id_survey) REFERENCES delivery_pulse_intranet.survey_templates(id)
);
CREATE INDEX survey_questions_templates_id_survey_idx ON delivery_pulse_intranet.survey_questions_templates USING btree (id_survey);

-- Column comments

COMMENT ON COLUMN delivery_pulse_intranet.survey_questions_templates.status IS 'enabled o disabled';
COMMENT ON COLUMN delivery_pulse_intranet.survey_questions_templates.id_cluster IS 'identificativo cluster question';

-- Permissions

ALTER TABLE delivery_pulse_intranet.survey_questions_templates OWNER TO postgres;
GRANT ALL ON TABLE delivery_pulse_intranet.survey_questions_templates TO postgres;


-- delivery_pulse_intranet.assessments definition

-- Drop table

-- DROP TABLE delivery_pulse_intranet.assessments;

CREATE TABLE delivery_pulse_intranet.assessments (
	id int4 NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	engagement_id int4 NOT NULL,
	"name" varchar(128) NOT NULL,
	status varchar(64) NOT NULL,
	start_date date NOT NULL,
	end_date date NOT NULL,
	"type" varchar(10) NOT NULL, -- CLIENT or TEAM
	CONSTRAINT assessments_pkey PRIMARY KEY (id),
	CONSTRAINT assessment_fk_engid FOREIGN KEY (engagement_id) REFERENCES delivery_pulse_intranet.engagements(id)
);
CREATE INDEX assessments_engagement_id_idx ON delivery_pulse_intranet.assessments USING btree (engagement_id);

-- Column comments

COMMENT ON COLUMN delivery_pulse_intranet.assessments.id IS 'Primary key';
COMMENT ON COLUMN delivery_pulse_intranet.assessments."type" IS 'CLIENT or TEAM';

-- Permissions

ALTER TABLE delivery_pulse_intranet.assessments OWNER TO postgres;
GRANT ALL ON TABLE delivery_pulse_intranet.assessments TO postgres;


-- delivery_pulse_intranet.assessment_instances definition

-- Drop table

-- DROP TABLE delivery_pulse_intranet.assessment_instances;

CREATE TABLE delivery_pulse_intranet.assessment_instances (
	id int4 NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	assessment_id int4 NOT NULL,
	status varchar(64) NOT NULL,
	username varchar(128) NULL,
	"name" varchar(256) NOT NULL,
	email varchar(128) NOT NULL,
	"role" varchar(128) NOT NULL,
	external_id varchar(50) NOT NULL, -- External survey identify
	start_datetime timestamptz NOT NULL, -- Inizio esecuzione survey
	end_datetime timestamptz NOT NULL, -- fine esecuzione survey
	CONSTRAINT assessment_instances_pkey PRIMARY KEY (id),
	CONSTRAINT assessment_instances_fk_assid FOREIGN KEY (assessment_id) REFERENCES delivery_pulse_intranet.assessments(id)
);
CREATE INDEX assessment_instances_assessment_id_idx ON delivery_pulse_intranet.assessment_instances USING btree (assessment_id);
CREATE UNIQUE INDEX assessment_instances_external_id_idx ON delivery_pulse_intranet.assessment_instances USING btree (external_id);

-- Column comments

COMMENT ON COLUMN delivery_pulse_intranet.assessment_instances.external_id IS 'External survey identify';
COMMENT ON COLUMN delivery_pulse_intranet.assessment_instances.start_datetime IS 'Inizio esecuzione survey';
COMMENT ON COLUMN delivery_pulse_intranet.assessment_instances.end_datetime IS 'fine esecuzione survey';

-- Permissions

ALTER TABLE delivery_pulse_intranet.assessment_instances OWNER TO postgres;
GRANT ALL ON TABLE delivery_pulse_intranet.assessment_instances TO postgres;


-- delivery_pulse_intranet.assessment_instance_questions definition

-- Drop table

-- DROP TABLE delivery_pulse_intranet.assessment_instance_questions;

CREATE TABLE delivery_pulse_intranet.assessment_instance_questions (
	id int4 NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	id_ass_instance int4 NULL,
	cluster_id varchar(128) NOT NULL,
	question varchar(64) NOT NULL,
	CONSTRAINT assessment_instance_questions_pkey PRIMARY KEY (id),
	CONSTRAINT assessment_instance_questions_fk FOREIGN KEY (id_ass_instance) REFERENCES delivery_pulse_intranet.assessment_instances(id)
);

-- Permissions

ALTER TABLE delivery_pulse_intranet.assessment_instance_questions OWNER TO postgres;
GRANT ALL ON TABLE delivery_pulse_intranet.assessment_instance_questions TO postgres;


-- delivery_pulse_intranet.assessment_instance_answer_base definition

-- Drop table

-- DROP TABLE delivery_pulse_intranet.assessment_instance_answer_base;

CREATE TABLE delivery_pulse_intranet.assessment_instance_answer_base (
	id int4 NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	id_question int4 NOT NULL,
	user_comment varchar(512) NULL,
	CONSTRAINT assessment_instance_answer_base_pkey PRIMARY KEY (id),
	CONSTRAINT assessment_instance_answer_base_fk_qstid FOREIGN KEY (id_question) REFERENCES delivery_pulse_intranet.assessment_instance_questions(id)
);

-- Permissions

ALTER TABLE delivery_pulse_intranet.assessment_instance_answer_base OWNER TO postgres;
GRANT ALL ON TABLE delivery_pulse_intranet.assessment_instance_answer_base TO postgres;


-- delivery_pulse_intranet.assessment_instance_answer definition

-- Drop table

-- DROP TABLE delivery_pulse_intranet.assessment_instance_answer;

CREATE TABLE delivery_pulse_intranet.assessment_instance_answer (
	id int4 NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	"name" varchar(64) NULL,
	value int4 NULL,
	CONSTRAINT assessment_instance_answer_pkey PRIMARY KEY (id),
	CONSTRAINT assessment_instance_answer_fk FOREIGN KEY (id) REFERENCES delivery_pulse_intranet.assessment_instance_answer_base(id)
);

-- Permissions

ALTER TABLE delivery_pulse_intranet.assessment_instance_answer OWNER TO postgres;
GRANT ALL ON TABLE delivery_pulse_intranet.assessment_instance_answer TO postgres;


-- delivery_pulse_intranet.roles definition
CREATE TABLE delivery_pulse_intranet.roles (
	id int4 NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	"name" varchar(128) NOT NULL,
	CONSTRAINT roles_pkey PRIMARY KEY (id),
	CONSTRAINT roles_unique_name UNIQUE (name)
);
-- Permissions

ALTER TABLE delivery_pulse_intranet.roles OWNER TO postgres;
GRANT ALL ON TABLE delivery_pulse_intranet.roles TO postgres;


-- delivery_pulse_intranet.users_roles definition
CREATE TABLE delivery_pulse_intranet.users_roles (
	id_user int4 NOT NULL,
	id_role int4 NOT NULL,
	CONSTRAINT users_roles_pkey PRIMARY KEY (id_user, id_role),
	CONSTRAINT users_roles_u_fk FOREIGN KEY (id_user) REFERENCES delivery_pulse_intranet.users(id),
	CONSTRAINT users_roles_r_fk FOREIGN KEY (id_role) REFERENCES delivery_pulse_intranet.roles(id)
);
-- Permissions

ALTER TABLE delivery_pulse_intranet.users_roles OWNER TO postgres;
GRANT ALL ON TABLE delivery_pulse_intranet.users_roles TO postgres;


-- Permissions

GRANT ALL ON SCHEMA delivery_pulse_intranet TO postgres;
